services:
  - type: web
    name: ai-platform-backend
    env: node
    region: frankfurt  # or oregon, virginia - choose based on your preference
    buildCommand: |
      npm install
      # Install Python and required dependencies
      apt-get update && apt-get install -y python3.9 python3-pip python3-dev build-essential
      # Create symbolic links
      ln -sf /usr/bin/python3.9 /usr/bin/python3 && ln -sf /usr/bin/python3.9 /usr/bin/python && ln -sf /usr/bin/pip3 /usr/bin/pip
      # Upgrade pip
      pip3 install --upgrade pip setuptools wheel
      # Install PyTorch first
      pip3 install torch==2.0.1 torchvision==0.15.2 --index-url https://download.pytorch.org/whl/cpu
      # Install remaining dependencies
      pip3 install --no-cache-dir -r python_requirements.txt
      # Download NLTK data
      python3 -c "import nltk; nltk.download('punkt'); nltk.download('stopwords'); nltk.download('wordnet'); nltk.download('omw-1.4')"
      # Download spaCy model
      python3 -m spacy download en_core_web_sm
    startCommand: npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: MONGODB_URI
        sync: false  # Add your MongoDB URI in the Render dashboard
    autoDeploy: false